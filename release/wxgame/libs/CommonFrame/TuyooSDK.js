console.log("TuyooSDK loaded"),FZ.TuyooSDK={SESSION_KEY:"TU_SESSION_STORAGE",LOCAL_GAME_TIME_RECORD:"LOCAL_GAME_TIME_RECORD",LOCAL_SHARE_TIMES_RECORD:"LOCAL_SHARE_TIMES_RECORD",newUser:!1,isFirstLogin:!0,login:function(){FZ.IsWechatPlatform()?(FZ.TuyooSDK.getSystemInfo(),FZ.TuyooSDK.getUserAreaInfo(),FZ.TuyooSDK.wechatLogin(),FZ.PropagateInterface._doHttpGetShareConfig()):"android"==navigator.platform&&(FZ.TuyooSDK.getUserAreaInfo(),FZ.AndroidAloneHelper.login(),FZ.TuyooSDK.updateLastLoginDate()),FZ.TuyooSDK.updateLastLoginDate()},updateLastLoginDate:function(){var t=(new Date).toLocaleDateString();this.lastLoginDate=FZ.Util.getItemFromLocalStorage("Last_Login_Date","0");FZ.Util.getItemFromLocalStorage("First_Login_Date",t)==t&&(this.newUser=!0,FZ.Util.setItemToLocalStorage("First_Login_Date",t)),this.isFirstLogin=this.lastLoginDate!=t,FZ.Util.setItemToLocalStorage("Last_Login_Date",t)},isTodayFirstLogin:function(){return this.isFirstLogin},isNewUser:function(){return this.newUser},setNewUser:function(t){this.newUser=t},getUserAreaInfo:function(){var t=FZ.SystemInfo.areaUrl+"api/iploc5/search/city";FZ.HttpUtil.httpGet({url:t},function(t){if(t&&1===t.ok){var e=t.loc;e&&e.length>3&&(FZ.LOGD("fengbing"," *--*-*-*-*-*  获取用户区域:  "+e[2]),FZ.UserInfo.userArea=e[2],FZ.UserInfo.userProvince=e[1])}},function(t){})},wechatLogin:function(){try{if(!FZ.IsWechatPlatform())return;FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeWxLoginStart,[]),wx.login({success:function(t){if(FZ.LOGD(null,"wx login success, params:"+JSON.stringify(t)),FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeWxLoginSuccess,[t.code]),t.code){var e=t.code;FZ.TuyooSDK.loginTuyooWithCode(e,{}),FZ.NotificationCenter.trigger(FZ.EventType.WEIXIN_LOGIN_SUCCESS)}},fail:function(t){FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeWxLoginFailed,[]),FZ.LOGD(null,"wx login fail, params:"+JSON.stringify(t)),FZ.NotificationCenter.trigger(FZ.EventType.WEIXIN_LOGIN_FAIL)},complete:function(t){}})}catch(t){FZ.LOGE("error:","FZ.TuyooSDK.wechatLogin——"+JSON.stringify(t))}},loginTuyooWith3rdSession:function(){try{if(!FZ.IsWechatPlatform())return;wx.getStorage({key:FZ.TuyooSDK.SESSION_KEY,success:function(t){t.data?wx.request({url:FZ.SystemInfo.loginUrl+"open/v3/user/processSnsIdNew",data:{snsId:t.data,deviceName:"wechatGame",clientId:FZ.SystemInfo.clientId,appId:FZ.SystemInfo.appId},success:function(t){FZ.LOGD(null,"tuyoo login success, params:"+JSON.stringify(t))},fail:function(t){FZ.LOGD(null,"tuyoo login fail, params:"+JSON.stringify(t))},complete:function(t){}}):FZ.TuyooSDK.wechatLogin()},fail:function(t){FZ.TuyooSDK.wechatLogin()},complete:function(t){}})}catch(t){FZ.LOGE("error:","FZ.TuyooSDK.loginTuyooWith3rdSession——"+JSON.stringify(t))}},loginTuyooWithCode:function(t,e){try{if(!FZ.IsWechatPlatform())return;wx.showShareMenu({withShareTicket:!0});var o=e.gender||0,r=FZ.Util.getLocalUUID();FZ.LOGD("local_uuid:",r);var n=FZ.SystemInfo.loginUrl,i={appId:FZ.SystemInfo.appId,wxAppId:FZ.SystemInfo.wxAppId,clientId:FZ.SystemInfo.clientId,snsId:"wxapp:"+t,uuid:r,gender:o,scene_id:FZ.UserInfo.scene_id||"",scene_param:FZ.UserInfo.scene_param||"",invite_id:FZ.UserInfo.invite_id||0};e&&e.nickName&&(i.nickName=e.nickName),e&&e.avatarUrl&&(i.avatarUrl=e.avatarUrl),FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeLoginSDKStart,[t,r,e.nickName]),wx.request({url:n+"open/v6/user/LoginBySnsIdNoVerify",header:{"content-type":"application/x-www-form-urlencoded"},data:i,method:"POST",success:function(o){FZ.LOGD(null,"tuyoo login success, params:"+JSON.stringify(o));var n=o.data;if(n.error&&1==n.error.code||!n.result||!n.result.userId)FZ.LOGE("TUYOO_SDK_LOGIN_FAIL",JSON.stringify(o));else{var i=n.result;FZ.UserInfo.userId=i.userId,FZ.UserInfo.userName=i.userName,FZ.UserInfo.userPic=i.purl,FZ.UserInfo.authorCode=i.authorCode,FZ.UserInfo.wxgame_session_key=i.wxgame_session_key,FZ.LOGD(null,"userId:"+FZ.UserInfo.userId+" userName:"+FZ.UserInfo.userName+" userPic:"+FZ.UserInfo.userPic),FZ.UserInfo.userId&&FZ.UserInfo.userName?FZ.LOGE("TUYOO_SDK_LOGIN_SUCCESS",JSON.stringify(o)):FZ.LOGE("TUYOO_SDK_LOGIN_FAIL",JSON.stringify(o));var a=i.token;FZ.LOGD(null,"token:"+a),wx.setStorage({key:FZ.TuyooSDK.SESSION_KEY,data:a}),FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeLoginSDKSuccess,[t,r,e.nickName,i.userId]),FZ.showScene&&FZ.showQuery&&FZ.showQuery.sourceCode&&FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeUserFrom,[FZ.showScene,FZ.showQuery.inviteCode,FZ.showQuery.sourceCode,FZ.showQuery.imageType,"GameStart"]),FZ.PropagateInterface.processRawShareConfigInfo();(o={url:""}).url=FZ.SystemInfo.loginUrl+"api/quanmzc/game/getGameInfo?gameId="+FZ.SystemInfo.gameId+"&userId="+FZ.UserInfo.userId+"&clientId"+FZ.SystemInfo.clientId,FZ.HttpUtil.httpGet(o,function(t){if(t&&t.result)if(console.log("用户信息-------1:"),void 0==t.result.gamedata||null==t.result.gamedata)console.log("用户信息-------2:"),FZ.SystemInfo.isNewUser=!0;else{1==JSON.parse(t.result.gamedata).checkPoint&&(console.log("用户信息-------2:"),FZ.SystemInfo.isNewUser=!0)}},function(){}),FZ.NotificationCenter.trigger(FZ.EventType.SDK_LOGIN_SUCCESS)}},fail:function(o){FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeLoginSDKFailed,[t,r,e.nickName]),FZ.LOGD(null,"tuyoo login fail, params:"+JSON.stringify(o)),FZ.LOGE("TUYOO_SDK_LOGIN_FAIL",JSON.stringify(o)),FZ.NotificationCenter.trigger(FZ.EventType.SDK_LOGIN_FAIL)},complete:function(t){}})}catch(t){FZ.LOGE("error:","FZ.TuyooSDK.loginTuyooWithCode——"+JSON.stringify(t))}},initWebSocketUrl:function(t){if(t&&t.tcpsrv){var e,o=t.tcpsrv.ip,r=t.tcpsrv.wsport||t.tcpsrv.port;e=FZ.SystemInfo.loginUrl.indexOf("https://")>-1?"wss://"+o+"/":"ws://"+o+":"+r.toString()+"/",FZ.LOGD(null,"webSocketUrl:"+e),FZ.SystemInfo.webSocketUrl=e}},getSystemInfo:function(){try{if(!FZ.IsWechatPlatform())return;wx.getSystemInfo({success:function(t){var e=t.model.indexOf("iPhone")>=0,o=t.windowHeight,r=0;r=e?812==o||896==o?2:736==o?4:1:3,FZ.UserInfo.systemType=r,FZ.UserInfo.wechatType=t.version,FZ.UserInfo.model=t.model,FZ.UserInfo.system=t.system,FZ.UserInfo.sdkVersion=t.SDKVersion,console.error("基础库版本为:"+FZ.UserInfo.sdkVersion),FZ.TuyooSDK.checkSdkVersion(),FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeSubmitVersionInfo,[t.version,t.SDKVersion,t.platform,t.system])},fail:function(){},complete:function(){}})}catch(t){FZ.LOGE("error:","FZ.TuyooSDK.getSystemInfo——"+JSON.stringify(t))}},checkSdkVersion:function(){FZ.TuyooSDK.compareVersion(FZ.UserInfo.sdkVersion,"2.1.0")<0&&wx.showModal({title:"提示",content:"当前微信版本过低，部分游戏功能将无法使用，请升级到最新微信版本后重试!",showCancel:!1,success:function(t){t.confirm?wx.exitMiniProgram():FZ.TuyooSDK.checkSdkVersion()},fail:function(t){FZ.TuyooSDK.checkSdkVersion()}})},compareVersion:function(t,e){if(void 0==t||null==t)return 1;t=t.split("."),e=e.split(".");for(var o=Math.max(t.length,e.length);t.length<o;)t.push("0");for(;e.length<o;)e.push("0");for(var r=0;r<o;r++){var n=parseInt(t[r]),i=parseInt(e[r]);if(n>i)return 1;if(n<i)return-1}return 0},wechatAuthorize:function(){try{if(!FZ.IsWechatPlatform())return;wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?FZ.NotificationCenter.trigger(FZ.EventType.START_AUTHORIZATION_SUCCESS):(FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeAuthorizationStart,[]),wx.authorize({scope:"scope.userInfo",success:function(){FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeAuthorizationSuccess,[]),FZ.NotificationCenter.trigger(FZ.EventType.START_AUTHORIZATION_SUCCESS)},fail:function(){FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeAuthorizationFailed,[]),FZ.NotificationCenter.trigger(FZ.EventType.START_AUTHORIZATION_FAILED)},complete:function(){}}))}})}catch(t){FZ.LOGE("error:","FZ.TuyooSDK.wechatAuthorize——"+JSON.stringify(t))}},createOrder:function(t,e,o,r,n,i){var a={};a.prodId=t,a.prodPrice=e,a.chargeType="wxapp.iap",a.gameId=FZ.SystemInfo.gameId,a.prodName=o,a.prodCount=r,a.appInfo=i||{},a.extraProdId=n||"",FZ.TuyooSDK.rechargeOrder(a)},orderCallFunc:function(t,e,o){try{if(!FZ.IsWechatPlatform())return;var r=FZ.Util.getLocalUUID();wx.request({url:t,header:{"content-type":"application/x-www-form-urlencoded"},data:{userId:FZ.UserInfo.userId,appId:FZ.SystemInfo.appId,wxAppId:FZ.SystemInfo.wxAppId,clientId:FZ.SystemInfo.clientId,imei:"null",uuid:r,platformOrderId:e},method:"POST",success:function(t){},fail:function(t){FZ.LOGE(null,"file = [Recharge] fun = [OrderCallFun] 充值失败 params = "+JSON.stringify(t))},complete:function(t){}})}catch(t){FZ.LOGE("error:","FZ.TuyooSDK.orderCallFunc——"+JSON.stringify(t))}},rechargeOrder:function(t){try{if(!FZ.IsWechatPlatform())return;var e=FZ.Util.getLocalUUID(),o=FZ.SystemInfo.loginUrl,r="hall37"==FZ.SystemInfo.hall_version?o+"open/v4/pay/order":o+"open/v5/pay/order";wx.request({url:r,header:{"content-type":"application/x-www-form-urlencoded"},data:{userId:FZ.UserInfo.userId,appId:FZ.SystemInfo.appId,wxAppId:FZ.SystemInfo.wxAppId,clientId:FZ.SystemInfo.clientId,imei:"null",uuid:e,prodId:t.prodId,prodName:t.prodName,prodCount:t.prodCount||1,prodPrice:t.prodPrice,chargeType:t.chargeType,gameId:t.gameId,appInfo:t.appInfo,mustcharge:t.mustcharge||1,prodOrderId:t.extraProdId},method:"POST",success:function(t){FZ.LOGE(null,"tuyoo rechargeOrder success, params:"+JSON.stringify(t));var e=t.data.result;if(0==e.code){var o=e.chargeInfo,r=o.chargeData,n=r.notifyUrl,i=r.platformOrderId,a=r.buyQuantity?r.buyQuantity:10*o.chargeTotal;FZ.LOGE(null,"tuyoo rechargeOrder success 创建订单成功, chargeData.mustcharge ="+r.mustcharge),r&&1==r.mustcharge?wx.requestMidasPayment({mode:r.mode,env:r.env,offerId:r.offerId,buyQuantity:a,platform:r.platform,currencyType:"CNY",zoneId:r.zoneId,success:function(t){FZ.TuyooSDK.orderCallFunc(n,i,o.chargeCoin)},fail:function(e){FZ.LOGE(null,"米大师支付 fail params = "+JSON.stringify(t)),e.errCode&&1==e.errCode&&FZ.TuyooSDK.cancelOrder(i)}}):r&&0==r.mustcharge&&FZ.TuyooSDK.orderCallFunc(n,i,o.chargeCoin)}else 1==e.code||e.code},fail:function(t){},complete:function(t){}})}catch(t){FZ.LOGE("error:","FZ.TuyooSDK.rechargeOrder——"+JSON.stringify(t))}},cancelOrder:function(t){try{var e=FZ.SystemInfo.loginUrl+"open/v4/pay/cancelorder",o={platformOrderId:t,appId:FZ.SystemInfo.appId,userId:FZ.UserInfo.userId,clientId:FZ.SystemInfo.clientId,payType:"wxapp.iap"};wx.request({url:e,header:{"content-type":"application/x-www-form-urlencoded"},data:o,method:"POST",success:function(t){FZ.LOGE(null,"tuyoo cancelOrder success, params:"+JSON.stringify(t))},fail:function(t){FZ.LOGE(null,"tuyoo cancelOrder fail, params:"+JSON.stringify(t))},complete:function(t){}})}catch(t){FZ.LOGE("error:","FZ.TuyooSDK.cancelOrder——"+JSON.stringify(t))}},freshLocalShareTimes:function(){try{var t=wx.getStorageSync(FZ.TuyooSDK.LOCAL_SHARE_TIMES_RECORD)||{},e=(new Date).toLocaleDateString();if(t[e]&&t[e].count)t[e].count=parseInt(t[e].count)+1;else{t[e]={count:1,status:0}}wx.setStorage({key:FZ.TuyooSDK.LOCAL_SHARE_TIMES_RECORD,data:t})}catch(t){console.error("error:","FZ.TuyooSDK.freshLocalShareTimes ===>"+JSON.stringify(t))}},processLocalRecord:function(){try{if(FZ.TuyooSDK.onShowTimeStamp=(new Date).getTime(),!FZ.UserInfo.userId)return;var t=(new Date).toLocaleDateString(),e=wx.getStorageSync(FZ.TuyooSDK.LOCAL_GAME_TIME_RECORD)||{};if(e)for(var o in e)o!=t&&0==e[o].status&&(FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeOnReportGameTime,[e[o].count,o]),e[o].status=1);var r=Object.keys(e),n={};if(r.length&&30<r.length){r.reverse();for(y=0;y<30;y++)r[y]&&e[r[y]]&&(n[r[y]]=e[r[y]])}else n=e;wx.setStorage({key:FZ.TuyooSDK.LOCAL_GAME_TIME_RECORD,data:n});var i=wx.getStorageSync(FZ.TuyooSDK.LOCAL_SHARE_TIMES_RECORD)||{};if(i)for(var o in i)o!=t&&0==i[o].status&&(FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeOnReportShareTimes,[i[o].count,o]),i[o].status=1);var a=Object.keys(i),c={};if(a.length&&30<a.length){a.reverse();for(var y=0;y<30;y++)a[y]&&i[a[y]]&&(c[a[y]]=i[a[y]])}else c=i;wx.setStorage({key:FZ.TuyooSDK.LOCAL_SHARE_TIMES_RECORD,data:c})}catch(t){console.error("error:","FZ.TuyooSDK.processLocalRecord ===>"+JSON.stringify(t))}},writeBackLocolRecord:function(){try{if(FZ.TuyooSDK.onShowTimeStamp<0)return;var t=wx.getStorageSync(FZ.TuyooSDK.LOCAL_GAME_TIME_RECORD)||{},e=new Date,o=e.getTime()-FZ.TuyooSDK.onShowTimeStamp,r=Date.parse(e.toLocaleDateString());if(r>FZ.TuyooSDK.onShowTimeStamp){var n=r-FZ.TuyooSDK.onShowTimeStamp,i=o-n,a=new Date(FZ.TuyooSDK.onShowTimeStamp).toLocaleDateString(),c=e.toLocaleDateString();if(t[a]&&t[a].count)t[a].count=parseInt(t[a].count)+n;else{y={count:n,status:0};t[a]=y}if(t[c]&&t[c].count)t[c].count=parseInt(t[c].count)+i;else{y={count:i,status:0};t[c]=y}}else{if(t[c=e.toLocaleDateString()]&&t[c].count)t[c].count=parseInt(t[c].count)+o;else{var y={count:o,status:0};t[c]=y}}wx.setStorage({key:FZ.TuyooSDK.LOCAL_GAME_TIME_RECORD,data:t}),FZ.TuyooSDK.onShowTimeStamp=-1}catch(t){console.error("error:","FZ.TuyooSDK.writeBackLocolRecord ===>"+JSON.stringify(t))}},getLocalGameTimeRecord:function(){try{return wx.getStorageSync(FZ.TuyooSDK.LOCAL_GAME_TIME_RECORD)||{}}catch(t){return{}}},getLocalShareTimesRecord:function(){try{return wx.getStorageSync(FZ.TuyooSDK.LOCAL_SHARE_TIMES_RECORD)||{}}catch(t){return{}}},postRVideoAdLog:function(t,e){"string"==typeof t&&t?1==e||2==e||3==e||4==e?FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeOnReportVideoAdsInfo,[t,e]):console.error("Error StatusCode! Please Check!"):console.error("Error sceneName! Please Check!")},getUserFeature:function(t,e,o,r,n){t&&e&&o||FZ.LOGE("getUserFeature","Error: Params Error, Please Check!");var i={},a=(new Date).getTime();i.act="api.getUserFeature",i.time=a,i.cloud_id=e,i.game_id=t,i.user_id=o;var c=this.getConfigSignStr(i),y=[];for(var s in i)y.push(s+"="+i[s]);y.push("sign="+c);var w="https://analy.ywdier.com/?"+y.join("&");wx.request({url:w,method:"GET",success:function(t){200==t.status?(FZ.NotificationCenter.trigger(FZ.EventType.GET_USERFEATURE_INFO_SUCCESS,t.data),r&&r(t.data)):(FZ.NotificationCenter.trigger(FZ.EventType.GET_USERFEATURE_INFO_FAIL),n&&n())},fail:function(t){FZ.NotificationCenter.trigger(FZ.EventType.GET_USERFEATURE_INFO_FAIL),n&&n()}})}},FZ.WechatInterfaceInit=function(){try{if(FZ.IsWechatPlatform()){wx.onShow(function(t){FZ.LOGE("","+++++++++++++++++onShow+++++++++++++++++"+JSON.stringify(t));var e=t.scene,o=t.query,r="";FZ.showScene=e,FZ.showQuery=o,FZ.UserInfo.scene_id=e,FZ.UserInfo.scene_param=o.from||"",FZ.UserInfo.invite_id=o.inviteCode||0,FZ.StateInfo.isOnForeground=!0,FZ.NotificationCenter.trigger(FZ.EventType.GAME_SHOW,t);var n=FZ.Util.checkLocalUUID()?1:0;if(o&&o.gdt_vid&&o.weixinadinfo){var i="gdt."+o.weixinadinfo;FZ.UserInfo.scene_param=i,FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeUserFrom,[e,i,n])}else o&&o.sourceCode?(1088==e?FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeUserFrom,[e,o.inviteCode,o.sourceCode,o.imageType,o.entryType,n]):FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeUserFrom,[e,o.inviteCode,o.sourceCode,o.imageType,"CardActive",n,o.template_type,o.fun_type]),FZ.UserInfo.FromShareCard=!0,1==FZ.SystemInfo.isDownZip&&(FZ.SystemInfo.isDownZip=!1,FZ.BiLog.clickStat(FZ.clickStatEventType.downZipStart,[]))):FZ.Util.isSceneQrCode(e)?(o.hasOwnProperty("scene")?r=o.scene:t.hasOwnProperty("path")&&(r=t.path),r.replace(".html",""),r=decodeURIComponent(r),FZ.UserInfo.scene_param=r,FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeUserFrom,[e,r,n])):FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeUserFrom,[e,o.from,n]);FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeOnShowTimeStampSubmit,[FZ.SystemInfo.FZVersion]),FZ.TuyooSDK.login(),FZ.SystemInfo.openLocalRecord&&setTimeout(FZ.TuyooSDK.processLocalRecord,2e3),FZ.AdManager&&FZ.AdManager.onForeGround&&FZ.AdManager.onForeGround()}),wx.onHide(function(){FZ.LOGE("","+++++++++++++++++onHide+++++++++++++++++"),FZ.BiLog.clickStat(FZ.clickStatEventType.clickStatEventTypeOnHideTimeStampSubmit,[]),FZ.UserInfo.scene_id=0,FZ.StateInfo.isOnForeground=!1,FZ.NotificationCenter.trigger(FZ.EventType.GAME_HIDE),FZ.SystemInfo.openLocalRecord&&FZ.TuyooSDK.writeBackLocolRecord()});var t=function(t){t.hasOwnProperty("isConnected")?FZ.StateInfo.networkConnected=t.isConnected:t.hasOwnProperty("errMsg")?FZ.StateInfo.networkConnected="getNetworkType:ok"==t.errMsg:FZ.StateInfo.networkConnected="none"!=t.networkType,FZ.StateInfo.networkType=t.networkType};wx.getNetworkType({success:t}),wx.onNetworkStatusChange(t),wx.onError(function(t){var e=new Date,o="userId:"+FZ.UserInfo.userId+"time:"+e.toDateString()+" "+e.toTimeString()+";"+t.message;FZ.BiLog.uploadLogTimely(o)})}else"android"==navigator.platform&&FZ.TuyooSDK.login()}catch(t){FZ.LOGE("error:","FZ.WechatInterfaceInit——"+JSON.stringify(t))}},FZ.WechatInterfaceInit();