console.log("TuyooSDK loaded"),tywx.TuyooSDK={SESSION_KEY:"TU_SESSION_STORAGE",LOCAL_GAME_TIME_RECORD:"LOCAL_GAME_TIME_RECORD",LOCAL_SHARE_TIMES_RECORD:"LOCAL_SHARE_TIMES_RECORD",newUser:!1,isFirstLogin:!0,login:function(){tywx.IsWechatPlatform()?(tywx.TuyooSDK.getSystemInfo(),tywx.TuyooSDK.getUserAreaInfo(),tywx.TuyooSDK.wechatLogin(),tywx.PropagateInterface._doHttpGetShareConfig()):"android"==navigator.platform&&(tywx.TuyooSDK.getUserAreaInfo(),tywx.AndroidAloneHelper.login(),tywx.TuyooSDK.updateLastLoginDate()),tywx.TuyooSDK.updateLastLoginDate()},updateLastLoginDate:function(){var t=(new Date).toLocaleDateString();this.lastLoginDate=tywx.Util.getItemFromLocalStorage("Last_Login_Date","0");tywx.Util.getItemFromLocalStorage("First_Login_Date",t)==t&&(this.newUser=!0,tywx.Util.setItemToLocalStorage("First_Login_Date",t)),this.isFirstLogin=this.lastLoginDate!=t,tywx.Util.setItemToLocalStorage("Last_Login_Date",t)},isTodayFirstLogin:function(){return this.isFirstLogin},isNewUser:function(){return this.newUser},setNewUser:function(t){this.newUser=t},getUserAreaInfo:function(){var t=tywx.SystemInfo.areaUrl+"api/iploc5/search/city";tywx.HttpUtil.httpGet({url:t},function(t){if(t&&1===t.ok){var e=t.loc;e&&e.length>3&&(tywx.LOGD("fengbing"," *--*-*-*-*-*  获取用户区域:  "+e[2]),tywx.UserInfo.userArea=e[2],tywx.UserInfo.userProvince=e[1])}},function(t){})},wechatLogin:function(){try{if(!tywx.IsWechatPlatform())return;tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeWxLoginStart,[]),wx.login({success:function(t){if(tywx.LOGD(null,"wx login success, params:"+JSON.stringify(t)),tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeWxLoginSuccess,[t.code]),t.code){var e=t.code;tywx.TuyooSDK.loginTuyooWithCode(e,{}),tywx.NotificationCenter.trigger(tywx.EventType.WEIXIN_LOGIN_SUCCESS)}},fail:function(t){tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeWxLoginFailed,[]),tywx.LOGD(null,"wx login fail, params:"+JSON.stringify(t)),tywx.NotificationCenter.trigger(tywx.EventType.WEIXIN_LOGIN_FAIL)},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.wechatLogin——"+JSON.stringify(t))}},loginTuyooWith3rdSession:function(){try{if(!tywx.IsWechatPlatform())return;wx.getStorage({key:tywx.TuyooSDK.SESSION_KEY,success:function(t){t.data?wx.request({url:tywx.SystemInfo.loginUrl+"open/v3/user/processSnsIdNew",data:{snsId:t.data,deviceName:"wechatGame",clientId:tywx.SystemInfo.clientId,appId:tywx.SystemInfo.appId},success:function(t){tywx.LOGD(null,"tuyoo login success, params:"+JSON.stringify(t))},fail:function(t){tywx.LOGD(null,"tuyoo login fail, params:"+JSON.stringify(t))},complete:function(t){}}):tywx.TuyooSDK.wechatLogin()},fail:function(t){tywx.TuyooSDK.wechatLogin()},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.loginTuyooWith3rdSession——"+JSON.stringify(t))}},loginTuyooWithCode:function(t,e){try{if(!tywx.IsWechatPlatform())return;wx.showShareMenu({withShareTicket:!0});var o=e.gender||0,r=tywx.Util.getLocalUUID();tywx.LOGD("local_uuid:",r);var n=tywx.SystemInfo.loginUrl,i={appId:tywx.SystemInfo.appId,wxAppId:tywx.SystemInfo.wxAppId,clientId:tywx.SystemInfo.clientId,snsId:"wxapp:"+t,uuid:r,gender:o,scene_id:tywx.UserInfo.scene_id||"",scene_param:tywx.UserInfo.scene_param||"",invite_id:tywx.UserInfo.invite_id||0};e&&e.nickName&&(i.nickName=e.nickName),e&&e.avatarUrl&&(i.avatarUrl=e.avatarUrl),tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeLoginSDKStart,[t,r,e.nickName]),wx.request({url:n+"open/v6/user/LoginBySnsIdNoVerify",header:{"content-type":"application/x-www-form-urlencoded"},data:i,method:"POST",success:function(o){tywx.LOGD(null,"tuyoo login success, params:"+JSON.stringify(o));var n=o.data;if(n.error&&1==n.error.code||!n.result||!n.result.userId)tywx.LOGE("TUYOO_SDK_LOGIN_FAIL",JSON.stringify(o));else{var i=n.result;tywx.UserInfo.userId=i.userId,tywx.UserInfo.userName=i.userName,tywx.UserInfo.userPic=i.purl,tywx.UserInfo.authorCode=i.authorCode,tywx.UserInfo.wxgame_session_key=i.wxgame_session_key,tywx.LOGD(null,"userId:"+tywx.UserInfo.userId+" userName:"+tywx.UserInfo.userName+" userPic:"+tywx.UserInfo.userPic),tywx.UserInfo.userId&&tywx.UserInfo.userName?tywx.LOGE("TUYOO_SDK_LOGIN_SUCCESS",JSON.stringify(o)):tywx.LOGE("TUYOO_SDK_LOGIN_FAIL",JSON.stringify(o));var a=i.token;tywx.LOGD(null,"token:"+a),wx.setStorage({key:tywx.TuyooSDK.SESSION_KEY,data:a}),tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeLoginSDKSuccess,[t,r,e.nickName,i.userId]),tywx.showScene&&tywx.showQuery&&tywx.showQuery.sourceCode&&tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,[tywx.showScene,tywx.showQuery.inviteCode,tywx.showQuery.sourceCode,tywx.showQuery.imageType,"GameStart"]),tywx.PropagateInterface.processRawShareConfigInfo();(o={url:""}).url=tywx.SystemInfo.loginUrl+"api/quanmzc/game/getGameInfo?gameId="+tywx.SystemInfo.gameId+"&userId="+tywx.UserInfo.userId+"&clientId"+tywx.SystemInfo.clientId,tywx.HttpUtil.httpGet(o,function(t){if(t&&t.result)if(console.log("用户信息-------1:"),void 0==t.result.gamedata||null==t.result.gamedata)console.log("用户信息-------2:"),tywx.SystemInfo.isNewUser=!0;else{1==JSON.parse(t.result.gamedata).checkPoint&&(console.log("用户信息-------2:"),tywx.SystemInfo.isNewUser=!0)}},function(){}),tywx.NotificationCenter.trigger(tywx.EventType.SDK_LOGIN_SUCCESS)}},fail:function(o){tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeLoginSDKFailed,[t,r,e.nickName]),tywx.LOGD(null,"tuyoo login fail, params:"+JSON.stringify(o)),tywx.LOGE("TUYOO_SDK_LOGIN_FAIL",JSON.stringify(o)),tywx.NotificationCenter.trigger(tywx.EventType.SDK_LOGIN_FAIL)},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.loginTuyooWithCode——"+JSON.stringify(t))}},initWebSocketUrl:function(t){if(t&&t.tcpsrv){var e,o=t.tcpsrv.ip,r=t.tcpsrv.wsport||t.tcpsrv.port;e=tywx.SystemInfo.loginUrl.indexOf("https://")>-1?"wss://"+o+"/":"ws://"+o+":"+r.toString()+"/",tywx.LOGD(null,"webSocketUrl:"+e),tywx.SystemInfo.webSocketUrl=e}},getSystemInfo:function(){try{if(!tywx.IsWechatPlatform())return;wx.getSystemInfo({success:function(t){var e=t.model.indexOf("iPhone")>=0,o=t.windowHeight,r=0;r=e?812==o||896==o?2:736==o?4:1:3,tywx.UserInfo.systemType=r,tywx.UserInfo.wechatType=t.version,tywx.UserInfo.model=t.model,tywx.UserInfo.system=t.system,tywx.UserInfo.sdkVersion=t.SDKVersion,console.error("基础库版本为:"+tywx.UserInfo.sdkVersion),tywx.TuyooSDK.checkSdkVersion(),tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeSubmitVersionInfo,[t.version,t.SDKVersion,t.platform,t.system])},fail:function(){},complete:function(){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.getSystemInfo——"+JSON.stringify(t))}},checkSdkVersion:function(){tywx.TuyooSDK.compareVersion(tywx.UserInfo.sdkVersion,"2.1.0")<0&&wx.showModal({title:"提示",content:"当前微信版本过低，部分游戏功能将无法使用，请升级到最新微信版本后重试!",showCancel:!1,success:function(t){t.confirm?wx.exitMiniProgram():tywx.TuyooSDK.checkSdkVersion()},fail:function(t){tywx.TuyooSDK.checkSdkVersion()}})},compareVersion:function(t,e){if(void 0==t||null==t)return 1;t=t.split("."),e=e.split(".");for(var o=Math.max(t.length,e.length);t.length<o;)t.push("0");for(;e.length<o;)e.push("0");for(var r=0;r<o;r++){var n=parseInt(t[r]),i=parseInt(e[r]);if(n>i)return 1;if(n<i)return-1}return 0},wechatAuthorize:function(){try{if(!tywx.IsWechatPlatform())return;wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?tywx.NotificationCenter.trigger(tywx.EventType.START_AUTHORIZATION_SUCCESS):(tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeAuthorizationStart,[]),wx.authorize({scope:"scope.userInfo",success:function(){tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeAuthorizationSuccess,[]),tywx.NotificationCenter.trigger(tywx.EventType.START_AUTHORIZATION_SUCCESS)},fail:function(){tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeAuthorizationFailed,[]),tywx.NotificationCenter.trigger(tywx.EventType.START_AUTHORIZATION_FAILED)},complete:function(){}}))}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.wechatAuthorize——"+JSON.stringify(t))}},createOrder:function(t,e,o,r,n,i){var a={};a.prodId=t,a.prodPrice=e,a.chargeType="wxapp.iap",a.gameId=tywx.SystemInfo.gameId,a.prodName=o,a.prodCount=r,a.appInfo=i||{},a.extraProdId=n||"",tywx.TuyooSDK.rechargeOrder(a)},orderCallFunc:function(t,e,o){try{if(!tywx.IsWechatPlatform())return;var r=tywx.Util.getLocalUUID();wx.request({url:t,header:{"content-type":"application/x-www-form-urlencoded"},data:{userId:tywx.UserInfo.userId,appId:tywx.SystemInfo.appId,wxAppId:tywx.SystemInfo.wxAppId,clientId:tywx.SystemInfo.clientId,imei:"null",uuid:r,platformOrderId:e},method:"POST",success:function(t){},fail:function(t){tywx.LOGE(null,"file = [Recharge] fun = [OrderCallFun] 充值失败 params = "+JSON.stringify(t))},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.orderCallFunc——"+JSON.stringify(t))}},rechargeOrder:function(t){try{if(!tywx.IsWechatPlatform())return;var e=tywx.Util.getLocalUUID(),o=tywx.SystemInfo.loginUrl,r="hall37"==tywx.SystemInfo.hall_version?o+"open/v4/pay/order":o+"open/v5/pay/order";wx.request({url:r,header:{"content-type":"application/x-www-form-urlencoded"},data:{userId:tywx.UserInfo.userId,appId:tywx.SystemInfo.appId,wxAppId:tywx.SystemInfo.wxAppId,clientId:tywx.SystemInfo.clientId,imei:"null",uuid:e,prodId:t.prodId,prodName:t.prodName,prodCount:t.prodCount||1,prodPrice:t.prodPrice,chargeType:t.chargeType,gameId:t.gameId,appInfo:t.appInfo,mustcharge:t.mustcharge||1,prodOrderId:t.extraProdId},method:"POST",success:function(t){tywx.LOGE(null,"tuyoo rechargeOrder success, params:"+JSON.stringify(t));var e=t.data.result;if(0==e.code){var o=e.chargeInfo,r=o.chargeData,n=r.notifyUrl,i=r.platformOrderId,a=r.buyQuantity?r.buyQuantity:10*o.chargeTotal;tywx.LOGE(null,"tuyoo rechargeOrder success 创建订单成功, chargeData.mustcharge ="+r.mustcharge),r&&1==r.mustcharge?wx.requestMidasPayment({mode:r.mode,env:r.env,offerId:r.offerId,buyQuantity:a,platform:r.platform,currencyType:"CNY",zoneId:r.zoneId,success:function(t){tywx.TuyooSDK.orderCallFunc(n,i,o.chargeCoin)},fail:function(e){tywx.LOGE(null,"米大师支付 fail params = "+JSON.stringify(t)),e.errCode&&1==e.errCode&&tywx.TuyooSDK.cancelOrder(i)}}):r&&0==r.mustcharge&&tywx.TuyooSDK.orderCallFunc(n,i,o.chargeCoin)}else 1==e.code||e.code},fail:function(t){},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.rechargeOrder——"+JSON.stringify(t))}},cancelOrder:function(t){try{var e=tywx.SystemInfo.loginUrl+"open/v4/pay/cancelorder",o={platformOrderId:t,appId:tywx.SystemInfo.appId,userId:tywx.UserInfo.userId,clientId:tywx.SystemInfo.clientId,payType:"wxapp.iap"};wx.request({url:e,header:{"content-type":"application/x-www-form-urlencoded"},data:o,method:"POST",success:function(t){tywx.LOGE(null,"tuyoo cancelOrder success, params:"+JSON.stringify(t))},fail:function(t){tywx.LOGE(null,"tuyoo cancelOrder fail, params:"+JSON.stringify(t))},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.cancelOrder——"+JSON.stringify(t))}},freshLocalShareTimes:function(){try{var t=wx.getStorageSync(tywx.TuyooSDK.LOCAL_SHARE_TIMES_RECORD)||{},e=(new Date).toLocaleDateString();if(t[e]&&t[e].count)t[e].count=parseInt(t[e].count)+1;else{t[e]={count:1,status:0}}wx.setStorage({key:tywx.TuyooSDK.LOCAL_SHARE_TIMES_RECORD,data:t})}catch(t){console.error("error:","tywx.TuyooSDK.freshLocalShareTimes ===>"+JSON.stringify(t))}},processLocalRecord:function(){try{if(tywx.TuyooSDK.onShowTimeStamp=(new Date).getTime(),!tywx.UserInfo.userId)return;var t=(new Date).toLocaleDateString(),e=wx.getStorageSync(tywx.TuyooSDK.LOCAL_GAME_TIME_RECORD)||{};if(e)for(var o in e)o!=t&&0==e[o].status&&(tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeOnReportGameTime,[e[o].count,o]),e[o].status=1);var r=Object.keys(e),n={};if(r.length&&30<r.length){r.reverse();for(y=0;y<30;y++)r[y]&&e[r[y]]&&(n[r[y]]=e[r[y]])}else n=e;wx.setStorage({key:tywx.TuyooSDK.LOCAL_GAME_TIME_RECORD,data:n});var i=wx.getStorageSync(tywx.TuyooSDK.LOCAL_SHARE_TIMES_RECORD)||{};if(i)for(var o in i)o!=t&&0==i[o].status&&(tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeOnReportShareTimes,[i[o].count,o]),i[o].status=1);var a=Object.keys(i),c={};if(a.length&&30<a.length){a.reverse();for(var y=0;y<30;y++)a[y]&&i[a[y]]&&(c[a[y]]=i[a[y]])}else c=i;wx.setStorage({key:tywx.TuyooSDK.LOCAL_SHARE_TIMES_RECORD,data:c})}catch(t){console.error("error:","tywx.TuyooSDK.processLocalRecord ===>"+JSON.stringify(t))}},writeBackLocolRecord:function(){try{if(tywx.TuyooSDK.onShowTimeStamp<0)return;var t=wx.getStorageSync(tywx.TuyooSDK.LOCAL_GAME_TIME_RECORD)||{},e=new Date,o=e.getTime()-tywx.TuyooSDK.onShowTimeStamp,r=Date.parse(e.toLocaleDateString());if(r>tywx.TuyooSDK.onShowTimeStamp){var n=r-tywx.TuyooSDK.onShowTimeStamp,i=o-n,a=new Date(tywx.TuyooSDK.onShowTimeStamp).toLocaleDateString(),c=e.toLocaleDateString();if(t[a]&&t[a].count)t[a].count=parseInt(t[a].count)+n;else{y={count:n,status:0};t[a]=y}if(t[c]&&t[c].count)t[c].count=parseInt(t[c].count)+i;else{y={count:i,status:0};t[c]=y}}else{if(t[c=e.toLocaleDateString()]&&t[c].count)t[c].count=parseInt(t[c].count)+o;else{var y={count:o,status:0};t[c]=y}}wx.setStorage({key:tywx.TuyooSDK.LOCAL_GAME_TIME_RECORD,data:t}),tywx.TuyooSDK.onShowTimeStamp=-1}catch(t){console.error("error:","tywx.TuyooSDK.writeBackLocolRecord ===>"+JSON.stringify(t))}},getLocalGameTimeRecord:function(){try{return wx.getStorageSync(tywx.TuyooSDK.LOCAL_GAME_TIME_RECORD)||{}}catch(t){return{}}},getLocalShareTimesRecord:function(){try{return wx.getStorageSync(tywx.TuyooSDK.LOCAL_SHARE_TIMES_RECORD)||{}}catch(t){return{}}},postRVideoAdLog:function(t,e){"string"==typeof t&&t?1==e||2==e||3==e||4==e?tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeOnReportVideoAdsInfo,[t,e]):console.error("Error StatusCode! Please Check!"):console.error("Error sceneName! Please Check!")},getUserFeature:function(t,e,o,r,n){t&&e&&o||tywx.LOGE("getUserFeature","Error: Params Error, Please Check!");var i={},a=(new Date).getTime();i.act="api.getUserFeature",i.time=a,i.cloud_id=e,i.game_id=t,i.user_id=o;var c=this.getConfigSignStr(i),y=[];for(var s in i)y.push(s+"="+i[s]);y.push("sign="+c);var w="https://analy.ywdier.com/?"+y.join("&");wx.request({url:w,method:"GET",success:function(t){200==t.status?(tywx.NotificationCenter.trigger(tywx.EventType.GET_USERFEATURE_INFO_SUCCESS,t.data),r&&r(t.data)):(tywx.NotificationCenter.trigger(tywx.EventType.GET_USERFEATURE_INFO_FAIL),n&&n())},fail:function(t){tywx.NotificationCenter.trigger(tywx.EventType.GET_USERFEATURE_INFO_FAIL),n&&n()}})}},tywx.WechatInterfaceInit=function(){try{if(tywx.IsWechatPlatform()){wx.onShow(function(t){tywx.LOGE("","+++++++++++++++++onShow+++++++++++++++++"+JSON.stringify(t));var e=t.scene,o=t.query,r="";tywx.showScene=e,tywx.showQuery=o,tywx.UserInfo.scene_id=e,tywx.UserInfo.scene_param=o.from||"",tywx.UserInfo.invite_id=o.inviteCode||0,tywx.StateInfo.isOnForeground=!0,tywx.NotificationCenter.trigger(tywx.EventType.GAME_SHOW,t);var n=tywx.Util.checkLocalUUID()?1:0;if(o&&o.gdt_vid&&o.weixinadinfo){var i="gdt."+o.weixinadinfo;tywx.UserInfo.scene_param=i,tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,[e,i,n])}else o&&o.sourceCode?(1088==e?tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,[e,o.inviteCode,o.sourceCode,o.imageType,o.entryType,n]):tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,[e,o.inviteCode,o.sourceCode,o.imageType,"CardActive",n,o.template_type,o.fun_type]),tywx.UserInfo.FromShareCard=!0,1==tywx.SystemInfo.isDownZip&&(tywx.SystemInfo.isDownZip=!1,tywx.BiLog.clickStat(tywx.clickStatEventType.downZipStart,[]))):tywx.Util.isSceneQrCode(e)?(o.hasOwnProperty("scene")?r=o.scene:t.hasOwnProperty("path")&&(r=t.path),r.replace(".html",""),r=decodeURIComponent(r),tywx.UserInfo.scene_param=r,tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,[e,r,n])):tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,[e,o.from,n]);tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeOnShowTimeStampSubmit,[tywx.SystemInfo.tywxVersion]),tywx.TuyooSDK.login(),tywx.SystemInfo.openLocalRecord&&setTimeout(tywx.TuyooSDK.processLocalRecord,2e3),tywx.AdManager&&tywx.AdManager.onForeGround&&tywx.AdManager.onForeGround()}),wx.onHide(function(){tywx.LOGE("","+++++++++++++++++onHide+++++++++++++++++"),tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeOnHideTimeStampSubmit,[]),tywx.UserInfo.scene_id=0,tywx.StateInfo.isOnForeground=!1,tywx.NotificationCenter.trigger(tywx.EventType.GAME_HIDE),tywx.SystemInfo.openLocalRecord&&tywx.TuyooSDK.writeBackLocolRecord()});var t=function(t){t.hasOwnProperty("isConnected")?tywx.StateInfo.networkConnected=t.isConnected:t.hasOwnProperty("errMsg")?tywx.StateInfo.networkConnected="getNetworkType:ok"==t.errMsg:tywx.StateInfo.networkConnected="none"!=t.networkType,tywx.StateInfo.networkType=t.networkType};wx.getNetworkType({success:t}),wx.onNetworkStatusChange(t),wx.onError(function(t){var e=new Date,o="userId:"+tywx.UserInfo.userId+"time:"+e.toDateString()+" "+e.toTimeString()+";"+t.message;tywx.BiLog.uploadLogTimely(o)})}else"android"==navigator.platform&&tywx.TuyooSDK.login()}catch(t){tywx.LOGE("error:","tywx.WechatInterfaceInit——"+JSON.stringify(t))}},tywx.WechatInterfaceInit();